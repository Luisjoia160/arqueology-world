<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArchaeoVision | Plataforma Profissional de Arqueologia Digital</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Raleway:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6D4C41;
            --primary-dark: #3E2723;
            --primary-light: #D7CCC8;
            --secondary: #8D6E63;
            --accent: #BCAAA4;
            --light: #EFEBE9;
            --dark: #260E04;
            --text: #4E342E;
            --text-light: #8D6E63;
            --highlight: #A1887F;
            --success: #689F38;
            --gold: #C9B037;
            --add-btn: #28a745;
            --add-btn-hover: #218838;
            --logout-btn: #dc3545;
            --logout-btn-hover: #c82333;
        }

        /* Reset e estilos base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Raleway', sans-serif;
            line-height: 1.7;
            color: var(--text);
            background-color: var(--light);
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: var(--primary-dark);
            color: white;
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            border-bottom: 2px solid var(--gold);
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: white;
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: translateY(-2px);
        }

        .logo img {
            height: 45px;
            margin-right: 12px;
            border-radius: 8px;
            border: 2px solid var(--gold);
        }

        .logo-text {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .logo-text span {
            color: var(--gold);
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            padding: 8px 0;
            position: relative;
        }

        nav a:after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            background: var(--gold);
            bottom: 0;
            left: 0;
            transition: width 0.3s ease-out;
        }

        nav a:hover {
            color: var(--gold);
        }

        nav a:hover:after {
            width: 100%;
        }

        .cta-button {
            background: var(--gold);
            color: var(--dark);
            padding: 0.7rem 1.8rem;
            border-radius: 25px;
            font-weight: 700;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            border: 2px solid var(--gold);
        }

        .cta-button:hover {
            background: transparent;
            color: var(--gold);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(201, 176, 55, 0.3);
        }

        /* Botão Adicionar */
        .add-btn {
            background: var(--add-btn);
            color: white;
            border: none;
            padding: 0.6rem 1.4rem;
            border-radius: 25px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: 2px solid var(--add-btn);
        }

        .add-btn:hover {
            background: transparent;
            color: var(--add-btn);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        /* Botão Logout */
        .logout-btn {
            background: var(--logout-btn);
            color: white;
            border: none;
            padding: 0.5rem 1.2rem;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            border: 2px solid var(--logout-btn);
        }

        .logout-btn:hover {
            background: transparent;
            color: var(--logout-btn);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        /* Container para informações do usuário */
        .user-info-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-welcome {
            color: var(--gold);
            font-size: 14px;
            font-weight: 600;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(38, 14, 4, 0.85), rgba(38, 14, 4, 0.9)), url('https://images.unsplash.com/photo-1544551763-46a013bb70d5?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            padding: 200px 0 120px;
            text-align: center;
            position: relative;
        }

        .hero:before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100px;
            background: linear-gradient(transparent, var(--light));
            z-index: 1;
        }

        .hero-content {
            max-width: 850px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        .hero-content h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3.8rem;
            margin-bottom: 1.5rem;
            font-weight: 700;
            color: white;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            animation: fadeInUp 1s ease-out;
        }

        .hero-content p {
            font-size: 1.4rem;
            margin-bottom: 2.5rem;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            opacity: 0.9;
            font-weight: 300;
            animation: fadeInUp 1s ease-out 0.2s forwards;
            opacity: 0;
        }

        .hero-buttons {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            animation: fadeInUp 1s ease-out 0.4s forwards;
            opacity: 0;
        }

        .btn {
            padding: 14px 32px;
            border: none;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 180px;
        }

        .btn-primary {
            background: var(--gold);
            color: var(--dark);
            border: 2px solid var(--gold);
        }

        .btn-primary:hover {
            background: transparent;
            color: var(--gold);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(201, 176, 55, 0.4);
        }

        .btn-secondary {
            background: transparent;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .btn-secondary:hover {
            background: white;
            color: var(--dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 255, 255, 0.2);
        }

        /* Seção Saiba Mais */
        .saiba-mais-sobre {
            padding: 100px 0;
            background: white;
            position: relative;
        }

        .saiba-mais-sobre:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100px;
            background: linear-gradient(var(--light), white);
        }

        .saiba-mais-sobre h1 {
            font-family: 'Playfair Display', serif;
            color: var(--dark);
            font-size: 3rem;
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
        }

        .saiba-mais-sobre h1:after {
            content: '';
            position: absolute;
            width: 100px;
            height: 4px;
            background: var(--primary);
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 2px;
        }

        .saiba-mais-sobre p {
            font-size: 1.3rem;
            line-height: 1.8;
            max-width: 800px;
            margin: 3rem auto 0;
            text-align: center;
            color: var(--text-light);
        }

        /* Seção do Mapa */
        .map-section {
            padding: 100px 0;
            background: var(--light);
            position: relative;
        }

        .map-section:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100px;
            background: linear-gradient(white, var(--light));
        }

        .section-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .section-title {
            font-family: 'Playfair Display', serif;
            color: var(--dark);
            font-size: 2.8rem;
            margin-bottom: 1.5rem;
            position: relative;
            display: inline-block;
        }

        .section-title:after {
            content: '';
            position: absolute;
            width: 100px;
            height: 4px;
            background: var(--primary);
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 2px;
        }

        .section-subtitle {
            font-size: 1.2rem;
            color: var(--text-light);
            max-width: 600px;
            margin: 2rem auto 0;
            line-height: 1.6;
        }

        .map-container {
            position: relative;
            height: 650px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            border: 2px solid var(--primary-light);
        }

        #archaeologicalMap {
            height: 100%;
            width: 100%;
        }

        .map-overlay {
            position: absolute;
            top: 25px;
            right: 25px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 220px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--primary-light);
        }

        .legend-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--primary-light);
        }

        .legend-header h3 {
            color: var(--primary);
            font-size: 1.1rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-button {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            color: var(--text-light);
            transition: color 0.3s ease;
        }

        .toggle-button:hover {
            color: var(--primary);
        }

        .map-legend {
            padding: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px 0;
            border-bottom: 1px dashed var(--primary-light);
        }

        .legend-color {
            width: 22px;
            height: 22px;
            border-radius: 6px;
            margin-right: 12px;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        /* Filtros do Mapa */
        .map-filters {
            position: absolute;
            top: 25px;
            left: 25px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 220px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--primary-light);
            padding: 20px;
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .filter-header h3 {
            color: var(--primary);
            font-size: 1.1rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group {
            margin-bottom: 15px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9rem;
        }

        .filter-group select {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--primary-light);
            border-radius: 6px;
            font-size: 14px;
            font-family: 'Raleway', sans-serif;
            background: white;
        }

        .filter-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .filter-btn {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid var(--primary);
            background: var(--primary);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            background: transparent;
            color: var(--primary);
        }

        .filter-btn.secondary {
            background: transparent;
            color: var(--primary);
        }

        .filter-btn.secondary:hover {
            background: var(--primary);
            color: white;
        }

        /* Modal de Adicionar */
        .add-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(38, 14, 4, 0.8);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .add-modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 35px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 2px solid var(--gold);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 20px;
        }

        .modal-header h2 {
            margin: 0;
            color: var(--primary);
            font-size: 1.8rem;
            font-family: 'Playfair Display', serif;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-light);
            transition: color 0.3s ease;
        }

        .close-modal:hover {
            color: var(--primary);
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
            font-size: 1rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--primary-light);
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Raleway', sans-serif;
            background: white;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(109, 76, 65, 0.1);
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--primary-light);
        }

        /* Mapa dentro do modal */
        .modal-map-container {
            height: 300px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 2px solid var(--primary-light);
        }

        #modalMap {
            height: 100%;
            width: 100%;
        }

        .coordinates-input {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .coordinates-input input {
            flex: 1;
        }

        .map-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
        }

        .map-controls button {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid var(--primary-light);
            background: var(--light);
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .map-controls button:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .coordinates-info {
            background: var(--light);
            padding: 12px 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 14px;
            text-align: center;
            color: var(--text);
            border-left: 4px solid var(--primary);
        }

        /* Estilos para os marcadores do mapa */
        .site-marker {
            text-align: center;
        }

        .marker-pin {
            width: 32px;
            height: 32px;
            border-radius: 50% 50% 50% 0;
            background: var(--primary);
            position: absolute;
            transform: rotate(-45deg);
            left: 50%;
            top: 50%;
            margin: -16px 0 0 -16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .site-marker i {
            position: absolute;
            width: 20px;
            font-size: 16px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            color: white;
        }

        .selection-marker .marker-pin {
            background: var(--success);
            border: 3px solid white;
            box-shadow: 0 0 15px rgba(104, 159, 56, 0.6);
        }

        /* Botão no popup */
        .site-link-button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 12px;
            width: 100%;
            font-family: 'Raleway', sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid var(--primary);
        }

        .site-link-button:hover {
            background: transparent;
            color: var(--primary);
        }

        /* Popup do mapa */
        .map-popup {
            max-width: 320px;
        }

        .map-popup h2 {
            color: var(--primary);
            margin-bottom: 12px;
            font-size: 1.4rem;
            font-family: 'Playfair Display', serif;
            border-bottom: 2px solid var(--gold);
            padding-bottom: 8px;
        }

        .map-popup img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 12px;
            border: 2px solid var(--primary-light);
        }

        .popup-meta p {
            margin-bottom: 8px;
            font-size: 0.95rem;
            line-height: 1.5;
            color: var(--text);
        }

        .popup-meta strong {
            color: var(--primary);
        }

        /* Seções adicionais */
        .features-section, .stratigraphy-section, .data-section, .cta-section {
            padding: 100px 0;
        }

        .features-section {
            background: white;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2.5rem;
        }

        .feature-card {
            background: white;
            padding: 2.5rem;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .feature-card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            border-color: var(--primary-light);
        }

        .feature-card:hover:before {
            transform: scaleX(1);
        }

        .feature-icon {
            font-size: 3.5rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }

        .feature-card:hover .feature-icon {
            transform: scale(1.1);
            color: var(--gold);
        }

        .feature-card h3 {
            color: var(--dark);
            margin-bottom: 1.2rem;
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
        }

        .feature-card p {
            color: var(--text-light);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .feature-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .feature-link:hover {
            color: var(--gold);
            transform: translateX(5px);
        }

        /* CTA Section */
        .cta-section {
            background: linear-gradient(135deg, var(--primary-dark), var(--dark));
            color: white;
            text-align: center;
            position: relative;
            padding: 120px 0;
        }

        .cta-section:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100px;
            background: linear-gradient(var(--light), transparent);
        }

        .cta-content {
            max-width: 700px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        .cta-content h2 {
            font-size: 2.8rem;
            margin-bottom: 1.5rem;
            color: white;
            font-family: 'Playfair Display', serif;
        }

        .cta-content p {
            font-size: 1.3rem;
            margin-bottom: 2.5rem;
            opacity: 0.9;
            line-height: 1.6;
        }

        /* Footer */
        footer {
            background: var(--dark);
            color: white;
            padding: 80px 0 30px;
            position: relative;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 3rem;
            margin-bottom: 3rem;
        }

        .footer-column h3 {
            color: var(--gold);
            margin-bottom: 1.5rem;
            font-family: 'Playfair Display', serif;
            font-size: 1.4rem;
            position: relative;
            padding-bottom: 12px;
        }

        .footer-column h3:after {
            content: '';
            position: absolute;
            width: 50px;
            height: 3px;
            background: var(--gold);
            bottom: 0;
            left: 0;
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 0.8rem;
        }

        .footer-column a {
            color: var(--primary-light);
            text-decoration: none;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .footer-column a:hover {
            color: var(--gold);
            transform: translateX(8px);
        }

        .footer-social {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .footer-social a {
            color: var(--primary-light);
            font-size: 1.3rem;
            transition: all 0.3s ease;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .footer-social a:hover {
            color: var(--gold);
            background: rgba(201, 176, 55, 0.2);
            transform: translateY(-3px);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 2.5rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: var(--primary-light);
            font-size: 0.95rem;
        }

        /* Animações */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Modal de Login */
        .login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(38, 14, 4, 0.8);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .login-modal.active {
            display: flex;
        }

        .login-content {
            background: white;
            padding: 35px;
            border-radius: 15px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 2px solid var(--gold);
        }

        .login-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 20px;
        }

        .login-header h2 {
            margin: 0;
            color: var(--primary);
            font-size: 1.8rem;
            font-family: 'Playfair Display', serif;
        }

        .login-options {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .login-option {
            flex: 1;
            padding: 10px;
            text-align: center;
            background: var(--light);
            border: 2px solid var(--primary-light);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .login-option.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .admin-info {
            background: var(--light);
            padding: 12px 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 14px;
            color: var(--text);
            border-left: 4px solid var(--gold);
        }

        /* Estilos para upload de arquivo */
        .upload-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .upload-option {
            flex: 1;
            text-align: center;
            padding: 12px;
            background: var(--light);
            border: 2px solid var(--primary-light);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .upload-option.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .file-upload-container {
            margin-bottom: 15px;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-input {
            position: absolute;
            left: -9999px;
        }

        .file-input-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            background: var(--light);
            border: 2px dashed var(--primary-light);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            color: var(--text-light);
        }

        .file-input-button:hover {
            background: var(--primary-light);
            color: var(--primary);
        }

        .file-name {
            margin-top: 8px;
            font-size: 0.9rem;
            color: var(--text-light);
            text-align: center;
        }

        .image-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 15px;
            border-radius: 8px;
            border: 2px solid var(--primary-light);
            display: none;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 1.2rem;
            }

            nav ul {
                flex-wrap: wrap;
                justify-content: center;
                gap: 1rem;
            }

            .hero-content h1 {
                font-size: 2.8rem;
            }

            .hero-buttons {
                flex-direction: column;
                align-items: center;
                gap: 1rem;
            }

            .btn {
                width: 100%;
                max-width: 280px;
            }

            .map-overlay, .map-filters {
                position: relative;
                top: auto;
                right: auto;
                left: auto;
                margin: 20px auto;
                width: 90%;
            }

            .modal-content {
                width: 95%;
                margin: 20px;
                padding: 25px;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .coordinates-input {
                flex-direction: column;
            }

            .user-info-container {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }

            .footer-content {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
        }

        @media (max-width: 480px) {
            .hero-content h1 {
                font-size: 2.2rem;
            }

            .hero-content p {
                font-size: 1.1rem;
            }

            .section-title {
                font-size: 2.2rem;
            }

            .saiba-mais-sobre h1 {
                font-size: 2.2rem;
            }

            .saiba-mais-sobre p {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-container">
            <a class="logo">
                <img src="https://via.placeholder.com/45x45/6D4C41/FFFFFF?text=AW" alt="Archaeology World Logo">
                <div class="logo-text">Archaeology <span>World</span></div>
            </a>
            <nav>
                <ul>
                    <li><a href="#sobre">Sobre</a></li>
                    <li><a href="#map">Mapa Interativo</a></li>
                    <li><a href="#features">Recursos</a></li>
                    <li><a href="#data">Análises</a></li>
                    <li id="addButtonContainer">
                        <!-- Será preenchido dinamicamente via JavaScript -->
                    </li>
                    <li id="loginButtonContainer">
                        <!-- Será preenchido dinamicamente via JavaScript -->
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Modal para Login -->
    <div id="loginModal" class="login-modal">
        <div class="login-content">
            <div class="login-header">
                <h2>Login</h2>
                <button class="close-modal" onclick="closeLoginModal()">&times;</button>
            </div>
            
            <div class="login-options">
                <div class="login-option active" onclick="setLoginType('user')">Usuário</div>
                <div class="login-option" onclick="setLoginType('admin')">Administrador</div>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" name="loginEmail" required placeholder="seu@email.com">
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">Senha</label>
                    <input type="password" id="loginPassword" name="loginPassword" required placeholder="Sua senha">
                </div>
                
                <div id="adminInfo" class="admin-info" style="display: none;">
                    <strong>Credenciais de Administrador:</strong><br>
                    Email: admin@archaeology.com<br>
                    Senha: admin123
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeLoginModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Entrar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Adicionar Novo Item - ATUALIZADO COM UPLOAD FUNCIONAL -->
    <div id="addModal" class="add-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Adicionar Novo Sítio/Descoberta</h2>
                <button class="close-modal" onclick="closeAddModal()">&times;</button>
            </div>
            
            <form id="addForm">
                <div class="form-group">
                    <label for="itemName">Nome do Local/Descoberta *</label>
                    <input type="text" id="itemName" name="itemName" required placeholder="Ex: Sítio Arqueológico do Sol">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="itemType">Tipo *</label>
                        <select id="itemType" name="itemType" required>
                            <option value="">Selecione o tipo</option>
                            <option value="Sítio em Escavação">Sítio em Escavação</option>
                            <option value="Sítio Documentado">Sítio Documentado</option>
                            <option value="Área Protegida">Área Protegida</option>
                            <option value="Artefato Registrado">Artefato Registrado</option>
                            <option value="Estrutura Arqueológica">Estrutura Arqueológica</option>
                            <option value="Museus Arqueológicos">Museu Arqueológico</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="itemPeriod">Período *</label>
                        <input type="text" id="itemPeriod" name="itemPeriod" required placeholder="Ex: Holoceno Inicial">
                    </div>
                </div>

                <div class="form-group">
                    <label>Localização *</label>
                    <div class="map-controls">
                        <button type="button" onclick="enableMapSelection()">
                            <i class="fas fa-mouse-pointer"></i> Clicar no Mapa
                        </button>
                        <button type="button" onclick="useCurrentLocation()">
                            <i class="fas fa-location-arrow"></i> Minha Localização
                        </button>
                    </div>
                    
                    <div class="modal-map-container">
                        <div id="modalMap"></div>
                    </div>
                    
                    <div class="coordinates-info" id="coordinatesInfo">
                        Clique em "Clicar no Mapa" e depois clique no mapa para selecionar a localização
                    </div>
                    
                    <div class="form-row coordinates-input">
                        <div class="form-group">
                            <label for="itemLat">Latitude *</label>
                            <input type="number" id="itemLat" name="itemLat" required step="any" placeholder="Ex: -15.7942" min="-90" max="90">
                        </div>
                        <div class="form-group">
                            <label for="itemLng">Longitude *</label>
                            <input type="number" id="itemLng" name="itemLng" required step="any" placeholder="Ex: -47.8822" min="-180" max="180">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="itemDescription">Descrição</label>
                    <textarea id="itemDescription" name="itemDescription" placeholder="Descreva o sítio, descoberta ou informações relevantes..."></textarea>
                </div>

                <!-- ÁREA MODIFICADA: Upload de arquivo funcionando com o servidor -->
                <div class="form-group">
                    <label>Imagem do Local</label>
                    
                    <div class="upload-options">
                        <div class="upload-option active" onclick="setImageSource('file')">
                            <i class="fas fa-upload"></i> Upload do Computador
                        </div>
                        <div class="upload-option" onclick="setImageSource('url')">
                            <i class="fas fa-link"></i> URL da Imagem
                        </div>
                    </div>
                    
                    <div id="fileUploadContainer">
                        <div class="file-upload-container">
                            <div class="file-input-wrapper">
                                <input type="file" id="itemImageFile" name="itemImageFile" accept="image/*" class="file-input" onchange="handleFileSelect(event)">
                                <label for="itemImageFile" class="file-input-button">
                                    <i class="fas fa-cloud-upload-alt"></i> Escolher Arquivo
                                </label>
                            </div>
                            <div class="file-name" id="fileName">Nenhum arquivo selecionado</div>
                            <img id="imagePreview" class="image-preview" src="" alt="Pré-visualização">
                        </div>
                    </div>
                    
                    <div id="urlInputContainer" style="display: none;">
                        <input type="url" id="itemImageUrl" name="itemImageUrl" placeholder="https://exemplo.com/imagem.jpg">
                    </div>
                </div>

                <div class="form-group">
                    <label for="itemSiteUrl">URL do Site (opcional)</label>
                    <input type="url" id="itemSiteUrl" name="itemSiteUrl" placeholder="https://exemplo.com">
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary" id="submitBtn">Adicionar ao Mapa</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container hero-content">
            <h1>Revolucionando a Pesquisa Arqueológica com Tecnologia</h1>
            <p>Integração avançada de sistemas geoespaciais, documentação digital e análise de dados para arqueologia do século XXI</p>
            <div class="hero-buttons">
                <a href="#map" class="btn btn-primary">Explorar Plataforma</a>
                <a href="#features" class="btn btn-secondary">Ver Recursos</a>
            </div>
        </div>
    </section>

    <!-- Seção Sobre -->
    <section id="sobre" class="saiba-mais-sobre">
        <div class="container">
            <h1>O que é arqueologia?</h1>
            <p>A Arqueologia é a ciência que estuda o passado humano, tanto antigo quanto recente, através da análise de vestígios materiais como objetos, ferramentas, construções e fósseis. Ela busca compreender as culturas e os modos de vida das populações antigas, utilizando trabalho de campo (escavações), análise laboratorial de materiais e divulgação do conhecimento produzido.</p>
        </div>
    </section>

    <!-- Seção do Mapa Interativo -->
    <section id="map" class="map-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Mapa Arqueológico Interativo</h2>
                <p class="section-subtitle">Visualize, analise e documente sítios arqueológicos em tempo real com nossa plataforma geoespacial integrada</p>
            </div>
            
            <div class="map-container">
                <div id="archaeologicalMap"></div>
                
                <!-- Filtros do Mapa -->
                <div class="map-filters">
                    <div class="filter-header">
                      <h3><i class="fas fa-filter"></i> Filtros</h3>
                    </div>
                    
                    <div class="filter-group">
                        <label for="filterType">Tipo de Sítio</label>
                        <select id="filterType">
                            <option value="all">Todos os Tipos</option>
                            <option value="Sítio em Escavação">Sítio em Escavação</option>
                            <option value="Sítio Documentado">Sítio Documentado</option>
                            <option value="Área Protegida">Área Protegida</option>
                            <option value="Artefato Registrado">Artefato Registrado</option>
                            <option value="Estrutura Arqueológica">Estrutura Arqueológica</option>
                            <option value="Museus Arqueológicos">Museu Arqueológico</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="filterPeriod">Período</label>
                        <select id="filterPeriod">
                            <option value="all">Todos os Períodos</option>
                            <option value="Pleistoceno">Pleistoceno</option>
                            <option value="Holoceno">Holoceno</option>
                            <option value="Pré-colonial">Pré-colonial</option>
                            <option value="Colonial">Colonial</option>
                            <option value="Contemporâneo">Contemporâneo</option>
                        </select>
                    </div>
                    
                    <div class="filter-actions">
                        <button class="filter-btn" onclick="applyFilters()">Aplicar Filtros</button>
                        <button class="filter-btn secondary" onclick="resetFilters()">Limpar</button>
                    </div>
                </div>
                
                <!-- Legenda do Mapa -->
                <div class="map-overlay">
                    <div class="legend-header">
                      <h3><i class="fas fa-layer-group"></i> Legenda do Mapa</h3>
                      <button class="toggle-button" onclick="toggleLegend()">-</button>
                    </div>

                    <div class="map-legend" id="legendContent">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #ff0400;"></div>
                            <span>Sítio em Escavação</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #0022ff;"></div>
                            <span>Sítio Documentado</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #00ff0d;"></div>
                            <span>Área Protegida</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #ffb52c;"></div>
                            <span>Artefato Registrado</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #c800ff;"></div>
                            <span>Estrutura Arqueológica</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #ffff00;"></div>
                            <span>Museus Arqueológicos</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Seção de Recursos -->
    <section id="features" class="features-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Tecnologia Arqueológica Avançada</h2>
                <p class="section-subtitle">Ferramentas especializadas desenvolvidas para pesquisadores e equipes de campo</p>
            </div>
            
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-map-marked-alt"></i>
                    </div>
                    <h3>Georreferenciamento</h3>
                    <p>Precisão centimétrica no registro de coordenadas com integração de receptores GNSS de alta qualidade.</p>
                    <a href="#" class="feature-link">Saiba mais <i class="fas fa-arrow-right"></i></a>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-layer-group"></i>
                    </div>
                    <h3>Gestão Estratigráfica</h3>
                    <p>Documentação automatizada de camadas com registro fotográfico e descritivo.</p>
                    <a href="#" class="feature-link">Saiba mais <i class="fas fa-arrow-right"></i></a>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-database"></i>
                    </div>
                    <h3>Banco de Dados Centralizado</h3>
                    <p>Armazenamento seguro e organizado de todos os dados arqueológicos coletados.</p>
                    <a href="#" class="feature-link">Saiba mais <i class="fas fa-arrow-right"></i></a>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <h3>Análises Estatísticas</h3>
                    <p>Ferramentas avançadas para análise e interpretação de dados arqueológicos.</p>
                    <a href="#" class="feature-link">Saiba mais <i class="fas fa-arrow-right"></i></a>
                </div>
            </div>
        </div>
    </section>

    <!-- Seção CTA -->
    <section class="cta-section">
        <div class="container">
            <div class="cta-content">
                <h2 style="margin-bottom: 1rem;">Pronto para revolucionar sua pesquisa arqueológica?</h2>
                <p style="margin-bottom: 2rem;">Junte-se a centenas de pesquisadores que já utilizam nossa plataforma para documentação, análise e gestão de dados arqueológicos.</p>
                <a href="#contact" class="btn btn-primary">Solicitar Demonstração</a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="contact">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column footer-about">
                    <h3>Archaeology World</h3>
                    <p>Soluções tecnológicas avançadas para pesquisa e gestão do patrimônio arqueológico. Integrando conhecimento tradicional com inovação digital.</p>
                    <div class="footer-social">
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                        <a href="#"><i class="fab fa-researchgate"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                
                <div class="footer-column footer-links">
                    <h3>Recursos</h3>
                    <ul>
                        <li><a href="#">Documentação Técnica</a></li>
                        <li><a href="#">Tutoriais em Vídeo</a></li>
                        <li><a href="#">Banco de Dados Público</a></li>
                        <li><a href="#">Publicações Científicas</a></li>
                    </ul>
                </div>
                
                <div class="footer-column footer-contact">
                    <h3>Contato</h3>
                    <p><i class="fas fa-map-marker-alt"></i> Av. Arqueologia, 123 - Centro</p>
                    <p><i class="fas fa-phone"></i> (11) 98765-4321</p>
                    <p><i class="fas fa-envelope"></i> contato@archaeologyworld.com</p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 Archaeology World. Todos os direitos reservados.</p>
                <p>Desenvolvido com paixão pela arqueologia e tecnologia.</p>
            </div>
        </div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script>
        // Variáveis globais
        let map;
        let modalMap;
        let selectionMarker = null;
        let modalSelectionMarker = null;
        let isSelectingLocation = false;
        let userAddedSites = JSON.parse(localStorage.getItem('userAddedSites')) || [];
        let currentMarkers = [];
        let loginType = 'user';
        let imageSourceType = 'file'; // 'file' ou 'url'

        // Dados COMPLETOS dos sites originais
        const sites = [
            // ... (todos os sites originais permanecem aqui)
            // Para economizar espaço, removi a lista completa de sites
            // No código real, todos os sites originais devem estar aqui
        ];

        // ===== SISTEMA DE SALVAMENTO PERMANENTE ===== //
        class PermanentDataManager {
            constructor() {
                this.storageKey = 'archaeologyPermanentSites';
                this.adminEmails = ['admin@archaeology.com', 'arquelogo@usp.br'];
                this.init();
            }

            init() {
                if (!this.getData()) {
                    this.saveData({
                        sites: [],
                        metadata: {
                            created: new Date().toISOString(),
                            lastUpdate: new Date().toISOString(),
                            totalSites: 0,
                            version: '2.0'
                        }
                    });
                }
            }

            getData() {
                try {
                    const data = localStorage.getItem(this.storageKey);
                    return data ? JSON.parse(data) : null;
                } catch (e) {
                    console.error('Erro ao carregar dados:', e);
                    return null;
                }
            }

            saveData(data) {
                try {
                    localStorage.setItem(this.storageKey, JSON.stringify(data));
                    return true;
                } catch (e) {
                    console.error('Erro ao salvar dados:', e);
                    return false;
                }
            }

            getCurrentUser() {
                const user = localStorage.getItem('archaeologyUser') || sessionStorage.getItem('archaeologyUser');
                return user ? JSON.parse(user) : null;
            }

            isAdmin() {
                const user = this.getCurrentUser();
                return user && this.adminEmails.includes(user.email);
            }

            addPermanentSite(siteData) {
                if (!this.isAdmin()) {
                    console.warn('Apenas administradores podem adicionar pontos permanentes');
                    return false;
                }

                const data = this.getData();
                const newSite = {
                    ...siteData,
                    id: `perm-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                    addedBy: this.getCurrentUser().email,
                    addedDate: new Date().toISOString(),
                    approved: true,
                    permanent: true
                };

                data.sites.push(newSite);
                data.metadata.totalSites = data.sites.length;
                data.metadata.lastUpdate = new Date().toISOString();

                if (this.saveData(data)) {
                    console.log('✅ Site permanente salvo:', newSite);
                    return newSite;
                } else {
                    console.error('❌ Erro ao salvar site permanente');
                    return false;
                }
            }

            getPermanentSites() {
                const data = this.getData();
                return data ? data.sites : [];
            }

            getStats() {
                const data = this.getData();
                return data ? data.metadata : null;
            }
        }

        // Inicializar o gerenciador
        const permanentData = new PermanentDataManager();

        // ===== SISTEMA DE ADMINISTRAÇÃO COMPLETO ===== //

        // Função para verificar se usuário é admin
        function isUserAdmin() {
            const user = JSON.parse(localStorage.getItem('archaeologyUser') || sessionStorage.getItem('archaeologyUser') || 'null');
            const adminEmails = ['admin@archaeology.com', 'arquelogo@usp.br'];
            return user && adminEmails.includes(user.email);
        }

        // Função para mostrar notificações
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                max-width: 300px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                animation: slideInRight 0.3s ease;
            `;

            if (type === 'success') {
                notification.style.background = '#28a745';
            } else if (type === 'error') {
                notification.style.background = '#dc3545';
            } else {
                notification.style.background = '#17a2b8';
            }

            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Função para adicionar botão de exclusão nos popups (apenas para admin)
        function addDeleteButtonToPopup(marker, site) {
            if (!isUserAdmin()) return;

            marker.on('popupopen', function() {
                const popup = marker.getPopup();
                const popupContent = popup.getContent();
                
                if (!popupContent.includes('delete-site-button')) {
                    const deleteButton = `
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ccc;">
                            <button 
                                class="delete-site-button" 
                                onclick="deleteSite('${site.id}', this, ${site.isOriginal || false})"
                                style="
                                    background: #dc3545;
                                    color: white;
                                    border: none;
                                    padding: 8px 16px;
                                    border-radius: 6px;
                                    cursor: pointer;
                                    width: 100%;
                                    font-family: 'Raleway', sans-serif;
                                    font-weight: 600;
                                    transition: all 0.3s ease;
                                    border: 2px solid #dc3545;
                                "
                                onmouseover="this.style.background='transparent'; this.style.color='#dc3545'"
                                onmouseout="this.style.background='#dc3545'; this.style.color='white'"
                            >
                                <i class="fas fa-trash"></i> Excluir Ponto
                            </button>
                        </div>
                    `;
                    
                    const newContent = popupContent.replace('</div>', `${deleteButton}</div>`);
                    popup.setContent(newContent);
                }
            });
        }

        // Função para excluir site (AGORA FUNCIONA PARA TODOS OS SITES)
        function deleteSite(siteId, buttonElement, isOriginal = false) {
            if (!isUserAdmin()) {
                alert('Apenas administradores podem excluir pontos.');
                return;
            }

            if (!confirm('Tem certeza que deseja excluir este ponto? Esta ação não pode ser desfeita.')) {
                return;
            }

            buttonElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Excluindo...';
            buttonElement.disabled = true;

            try {
                // Remover do mapa primeiro
                removeSiteFromMap(siteId);

                if (isOriginal) {
                    // Para sites originais, adicionar à lista de sites excluídos
                    const excludedSites = JSON.parse(localStorage.getItem('excludedOriginalSites')) || [];
                    if (!excludedSites.includes(siteId)) {
                        excludedSites.push(siteId);
                        localStorage.setItem('excludedOriginalSites', JSON.stringify(excludedSites));
                    }
                } else {
                    // Para sites adicionados, remover dos dados permanentes (se for permanente)
                    const permanentDataManager = new PermanentDataManager();
                    const allSites = permanentDataManager.getPermanentSites();
                    const updatedSites = allSites.filter(site => site.id !== siteId);
                    
                    const data = permanentDataManager.getData();
                    data.sites = updatedSites;
                    data.metadata.totalSites = updatedSites.length;
                    data.metadata.lastUpdate = new Date().toISOString();
                    
                    permanentDataManager.saveData(data);

                    // Remover dos sites do usuário (se for temporário)
                    userAddedSites = userAddedSites.filter(site => site.id !== siteId);
                    localStorage.setItem('userAddedSites', JSON.stringify(userAddedSites));
                }

                // Fechar popup
                map.closePopup();

                // Mostrar mensagem de sucesso
                showNotification('Ponto excluído com sucesso!', 'success');

            } catch (error) {
                console.error('Erro ao excluir ponto:', error);
                showNotification('Erro ao excluir ponto. Tente novamente.', 'error');
                
                buttonElement.innerHTML = '<i class="fas fa-trash"></i> Excluir Ponto';
                buttonElement.disabled = false;
            }
        }

        // Função para remover marcador do mapa
        function removeSiteFromMap(siteId) {
            map.eachLayer((layer) => {
                if (layer instanceof L.CircleMarker) {
                    const popupContent = layer.getPopup()?.getContent();
                    if (popupContent && popupContent.includes(siteId)) {
                        map.removeLayer(layer);
                    }
                }
            });
        }

        // ===== FUNÇÃO addSiteToMap ATUALIZADA ===== //
        function addSiteToMap(site) {
            if (!map) {
                console.error('Mapa não inicializado');
                return;
            }

            const isAdmin = isUserAdmin();
            let finalSite = site;
            
            if (isAdmin && !site.permanent && !site.isOriginal) {
                const permanentSite = permanentData.addPermanentSite(site);
                if (permanentSite) {
                    finalSite = permanentSite;
                    console.log('🔄 Site convertido para permanente');
                }
            }

            const marker = L.circleMarker(finalSite.coords, {
                radius: 8 + (finalSite.artifacts / 100),
                fillColor: finalSite.color,
                color: isAdmin && finalSite.permanent ? '#000' : '#fff',
                weight: isAdmin && finalSite.permanent ? 3 : 2,
                opacity: 1,
                fillOpacity: 0.8
            }).addTo(map);

            // Armazenar referência ao marcador
            currentMarkers.push(marker);

            let buttonHtml = '';
            if (finalSite.siteUrl) {
                buttonHtml = `<button class="site-link-button" onclick="window.open('${finalSite.siteUrl}', '_blank')">Visitar Site</button>`;
            }

            const adminBadge = isAdmin && finalSite.permanent ? 
                '<div style="background: #28a745; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; margin-bottom: 8px; display: inline-block;">✓ Permanente</div>' : '';

            const originalBadge = finalSite.isOriginal ? 
                '<div style="background: #6f42c1; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; margin-bottom: 8px; display: inline-block;">✓ Original</div>' : '';

            const popupContent = `
                <div class="map-popup">
                    <h2>${finalSite.name}</h2>
                    ${adminBadge}
                    ${originalBadge}
                    <img src="${finalSite.image}" alt="${finalSite.name}" onerror="this.src='https://via.placeholder.com/300x200/2c5530/ffffff?text=Imagem+Não+Disponível'">
                    <div class="popup-meta">
                        <p><strong>Tipo:</strong> ${finalSite.type}</p>
                        <p><strong>Período:</strong> ${finalSite.period}</p>
                        <p><strong>Artefatos:</strong> ${finalSite.artifacts}</p>
                        <p><strong>Status:</strong> ${finalSite.status}</p>
                        ${finalSite.description ? `<p><strong>Descrição:</strong> ${finalSite.description}</p>` : ''}
                        ${isAdmin && finalSite.permanent ? `<p><strong>Adicionado por:</strong> ${finalSite.addedBy}</p>` : ''}
                        ${buttonHtml}
                    </div>
                </div>
            `;

            marker.bindPopup(popupContent);
            
            // Adicionar botão de exclusão se for admin
            addDeleteButtonToPopup(marker, finalSite);
            
            // Abrir popup automaticamente quando adicionado
            if (finalSite.justAdded) {
                setTimeout(() => marker.openPopup(), 500);
            }

            // Só salvar como temporário se NÃO for permanente E NÃO for original
            if (!finalSite.permanent && !finalSite.isOriginal) {
                userAddedSites.push(finalSite);
                localStorage.setItem('userAddedSites', JSON.stringify(userAddedSites));
            }

            return finalSite;
        }

        // Carregar sites permanentes no mapa
        function addPermanentSitesToMap() {
            const permanentSites = permanentData.getPermanentSites();
            console.log(`📊 Carregando ${permanentSites.length} sites permanentes`);
            
            permanentSites.forEach(site => {
                addSiteToMap(site);
            });
        }

        // Carregar sites do usuário (temporários)
        function addUserSitesToMap() {
            userAddedSites.forEach(site => {
                addSiteToMap(site);
            });
        }

        // Função principal para carregar todos os sites originais
        function addSitesToMap() {
            // Carregar lista de sites originais excluídos
            const excludedSites = JSON.parse(localStorage.getItem('excludedOriginalSites')) || [];
            
            // Sites originais - apenas os que não foram excluídos
            sites.forEach(site => {
                // Pular sites que foram excluídos pelo admin
                if (excludedSites.includes(site.id)) {
                    console.log(`⏭️ Pulando site excluído: ${site.name}`);
                    return;
                }

                // Marcar como site original
                site.isOriginal = true;
                
                const marker = L.circleMarker(site.coords, {
                    radius: 8 + (site.artifacts / 100),
                    fillColor: site.color,
                    color: '#fff',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(map);

                // Armazenar referência ao marcador
                currentMarkers.push(marker);

                let buttonHtml = '';
                if (site.siteUrl) {
                    buttonHtml = `<button class="site-link-button" onclick="window.open('${site.siteUrl}', '_blank')">Visitar Site</button>`;
                }

                const originalBadge = '<div style="background: #6f42c1; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; margin-bottom: 8px; display: inline-block;">✓ Original</div>';

                const popupContent = `
                    <div class="map-popup">
                        <h2>${site.name}</h2>
                        ${originalBadge}
                        <img src="${site.image}" alt="${site.name}" onerror="this.src='https://via.placeholder.com/300x200/2c5530/ffffff?text=Imagem+Não+Disponível'">
                        <div class="popup-meta">
                            <p><strong>Tipo:</strong> ${site.type}</p>
                            <p><strong>Período:</strong> ${site.period}</p>
                            <p><strong>Artefatos:</strong> ${site.artifacts}</p>
                            <p><strong>Status:</strong> ${site.status}</p>
                            ${site.description ? `<p><strong>Descrição:</strong> ${site.description}</p>` : ''}
                        </div>
                        ${buttonHtml}
                    </div>
                `;

                marker.bindPopup(popupContent);
                
                // Adicionar botão de exclusão se for admin
                addDeleteButtonToPopup(marker, site);
            });
        }

        // ===== FUNÇÃO PARA RESTAURAR SITES EXCLUÍDOS (PARA ADMIN) ===== //
        function restoreExcludedSites() {
            if (!isUserAdmin()) {
                alert('Apenas administradores podem restaurar sites.');
                return;
            }

            if (confirm('Deseja restaurar todos os sites originais excluídos?')) {
                localStorage.removeItem('excludedOriginalSites');
                showNotification('Sites restaurados com sucesso! Recarregue a página.', 'success');
                
                // Recarregar a página após 2 segundos
                setTimeout(() => {
                    location.reload();
                }, 2000);
            }
        }

        // ===== FUNÇÕES DE FILTRO ===== //
        function applyFilters() {
            const typeFilter = document.getElementById('filterType').value;
            const periodFilter = document.getElementById('filterPeriod').value;
            
            // Limpar todos os marcadores atuais
            currentMarkers.forEach(marker => {
                map.removeLayer(marker);
            });
            currentMarkers = [];
            
            // Recarregar sites com base nos filtros
            const excludedSites = JSON.parse(localStorage.getItem('excludedOriginalSites')) || [];
            
            // Sites originais filtrados
            sites.forEach(site => {
                if (excludedSites.includes(site.id)) return;
                
                // Aplicar filtros
                if (typeFilter !== 'all' && site.type !== typeFilter) return;
                if (periodFilter !== 'all' && !site.period.includes(periodFilter)) return;
                
                site.isOriginal = true;
                addSiteToMap(site);
            });
            
            // Sites permanentes filtrados
            const permanentSites = permanentData.getPermanentSites();
            permanentSites.forEach(site => {
                // Aplicar filtros
                if (typeFilter !== 'all' && site.type !== typeFilter) return;
                if (periodFilter !== 'all' && !site.period.includes(periodFilter)) return;
                
                addSiteToMap(site);
            });
            
            // Sites do usuário filtrados
            userAddedSites.forEach(site => {
                // Aplicar filtros
                if (typeFilter !== 'all' && site.type !== typeFilter) return;
                if (periodFilter !== 'all' && !site.period.includes(periodFilter)) return;
                
                addSiteToMap(site);
            });
            
            showNotification('Filtros aplicados com sucesso!', 'success');
        }
        
        function resetFilters() {
            document.getElementById('filterType').value = 'all';
            document.getElementById('filterPeriod').value = 'all';
            applyFilters();
        }

        // ===== FUNÇÕES DE LOGIN ===== //
        function setLoginType(type) {
            loginType = type;
            
            // Atualizar UI
            document.querySelectorAll('.login-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Mostrar informações de admin se necessário
            document.getElementById('adminInfo').style.display = type === 'admin' ? 'block' : 'none';
        }
        
        function openLoginModal() {
            document.getElementById('loginModal').classList.add('active');
        }
        
        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
        }
        
        function loginUser(email, password) {
            // Simulação de autenticação
            if (loginType === 'admin') {
                if (email === 'admin@archaeology.com' && password === 'admin123') {
                    const user = { email, name: 'Administrador', type: 'admin' };
                    localStorage.setItem('archaeologyUser', JSON.stringify(user));
                    return true;
                }
                return false;
            } else {
                // Para usuários normais, qualquer email/senha funciona (em um sistema real, isso seria diferente)
                const user = { email, name: email.split('@')[0], type: 'user' };
                localStorage.setItem('archaeologyUser', JSON.stringify(user));
                return true;
            }
        }
        
        function logoutUser() {
            localStorage.removeItem('archaeologyUser');
            sessionStorage.removeItem('archaeologyUser');
            updateUIForUser();
        }
        
        function updateUIForUser() {
            const user = JSON.parse(localStorage.getItem('archaeologyUser') || sessionStorage.getItem('archaeologyUser') || 'null');
            const addButtonContainer = document.getElementById('addButtonContainer');
            const loginButtonContainer = document.getElementById('loginButtonContainer');
            
            // Limpar containers
            addButtonContainer.innerHTML = '';
            loginButtonContainer.innerHTML = '';
            
            if (user) {
                // Usuário logado
                const userInfo = document.createElement('div');
                userInfo.className = 'user-info-container';
                userInfo.innerHTML = `
                    <span class="user-welcome">Olá, ${user.name}</span>
                    <button class="logout-btn" onclick="logoutUser()">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                `;
                loginButtonContainer.appendChild(userInfo);
                
                // Botão de adicionar
                const addButton = document.createElement('button');
                addButton.className = 'add-btn';
                addButton.innerHTML = '<i class="fas fa-plus"></i> Adicionar';
                addButton.onclick = openAddModal;
                addButtonContainer.appendChild(addButton);
                
                // Se for admin, adicionar botão de restaurar
                if (isUserAdmin()) {
                    console.log('👑 Modo Administrador Ativo');
                    
                    const restoreButton = document.createElement('button');
                    restoreButton.className = 'logout-btn';
                    restoreButton.innerHTML = '<i class="fas fa-undo"></i> Restaurar Sites';
                    restoreButton.onclick = restoreExcludedSites;
                    restoreButton.style.background = '#6f42c1';
                    restoreButton.style.borderColor = '#6f42c1';
                    restoreButton.onmouseover = function() {
                        this.style.background = 'transparent';
                        this.style.color = '#6f42c1';
                    };
                    restoreButton.onmouseout = function() {
                        this.style.background = '#6f42c1';
                        this.style.color = 'white';
                    };
                    
                    loginButtonContainer.appendChild(restoreButton);
                }
            } else {
                // Usuário não logado
                const loginButton = document.createElement('button');
                loginButton.className = 'cta-button';
                loginButton.innerHTML = '<i class="fas fa-sign-in-alt"></i> Entrar';
                loginButton.onclick = openLoginModal;
                loginButtonContainer.appendChild(loginButton);
            }
        }

        // ===== FUNÇÕES DE UPLOAD DE IMAGEM ===== //
        // Alternar entre upload de arquivo e URL
        function setImageSource(type) {
            imageSourceType = type;
            
            // Atualizar UI
            document.querySelectorAll('.upload-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Mostrar o container correto
            if (type === 'file') {
                document.getElementById('fileUploadContainer').style.display = 'block';
                document.getElementById('urlInputContainer').style.display = 'none';
            } else {
                document.getElementById('fileUploadContainer').style.display = 'none';
                document.getElementById('urlInputContainer').style.display = 'block';
            }
        }

        // Lidar com seleção de arquivo
        function handleFileSelect(event) {
            const file = event.target.files[0];
            const fileNameElement = document.getElementById('fileName');
            const imagePreview = document.getElementById('imagePreview');
            
            if (file) {
                fileNameElement.textContent = file.name;
                
                // Verificar se é uma imagem
                if (!file.type.match('image.*')) {
                    alert('Por favor, selecione apenas arquivos de imagem.');
                    event.target.value = '';
                    fileNameElement.textContent = 'Nenhum arquivo selecionado';
                    imagePreview.style.display = 'none';
                    return;
                }
                
                // Verificar tamanho do arquivo (limite de 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    alert('A imagem é muito grande. Por favor, selecione uma imagem menor que 5MB.');
                    event.target.value = '';
                    fileNameElement.textContent = 'Nenhum arquivo selecionado';
                    imagePreview.style.display = 'none';
                    return;
                }
                
                // Mostrar pré-visualização
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                fileNameElement.textContent = 'Nenhum arquivo selecionado';
                imagePreview.style.display = 'none';
            }
        }

        // Função para fazer upload da imagem para o backend
        async function uploadImagem(arquivo) {
            console.log('📤 Iniciando upload...', arquivo.name);
            
            const formData = new FormData();
            formData.append('imagem', arquivo);

            try {
                const response = await fetch('http://localhost:3000/upload', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }

                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'Erro no upload');
                }

                console.log('✅ Upload bem-sucedido:', data);
                return data.imageUrl;
                
            } catch (error) {
                console.error('❌ Erro no upload:', error);
                
                // Fallback: usar data URL se o servidor não estiver disponível
                console.log('🔄 Usando fallback para data URL');
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        resolve(e.target.result);
                    };
                    reader.readAsDataURL(arquivo);
                });
            }
        }

        // ===== INICIALIZAÇÃO ===== //
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar mapa principal
            map = L.map('archaeologicalMap').setView([-15.7942, -47.8822], 4);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            // Inicializar mapa do modal
            modalMap = L.map('modalMap').setView([-15.7942, -47.8822], 4);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(modalMap);
            
            // Configurar evento de clique no mapa modal
            modalMap.on('click', function(e) {
                if (isSelectingLocation) {
                    const lat = e.latlng.lat;
                    const lng = e.latlng.lng;
                    
                    document.getElementById('itemLat').value = lat;
                    document.getElementById('itemLng').value = lng;
                    document.getElementById('coordinatesInfo').textContent = 'Localização selecionada com sucesso!';
                    
                    // Adicionar marcador de seleção
                    if (modalSelectionMarker) {
                        modalMap.removeLayer(modalSelectionMarker);
                    }
                    
                    modalSelectionMarker = L.marker([lat, lng], {
                        icon: L.divIcon({
                            className: 'selection-marker',
                            html: '<div class="marker-pin"></div><i class="fas fa-map-pin"></i>',
                            iconSize: [30, 42],
                            iconAnchor: [15, 42]
                        })
                    }).addTo(modalMap);
                    
                    isSelectingLocation = false;
                }
            });

            // Carregar todos os sites
            addSitesToMap();
            addPermanentSitesToMap();
            addUserSitesToMap();
            
            // Atualizar UI baseada no usuário
            updateUIForUser();
            
            // Configurar formulário de login
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                if (loginUser(email, password)) {
                    showNotification('Login realizado com sucesso!', 'success');
                    closeLoginModal();
                    updateUIForUser();
                    this.reset();
                } else {
                    showNotification('Credenciais inválidas!', 'error');
                }
            });
        });

        // ===== FUNÇÕES DO MODAL ===== //
        function openAddModal() {
            document.getElementById('addModal').classList.add('active');
            // Resetar para upload de arquivo por padrão
            setImageSource('file');
        }

        function closeAddModal() {
            document.getElementById('addModal').classList.remove('active');
        }

        function toggleLegend() {
            const legendContent = document.getElementById('legendContent');
            const toggleButton = document.querySelector('.toggle-button');
            
            if (legendContent.style.display === 'none') {
                legendContent.style.display = 'block';
                toggleButton.textContent = '-';
            } else {
                legendContent.style.display = 'none';
                toggleButton.textContent = '+';
            }
        }

        // Funções do modal de adicionar
        function enableMapSelection() {
            isSelectingLocation = true;
            document.getElementById('coordinatesInfo').textContent = 'Clique em qualquer lugar do mapa para selecionar a localização';
        }

        function useCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    document.getElementById('itemLat').value = lat;
                    document.getElementById('itemLng').value = lng;
                    document.getElementById('coordinatesInfo').textContent = 'Localização atual capturada com sucesso!';
                });
            } else {
                alert('Geolocalização não é suportada por este navegador.');
            }
        }

        // Configurar formulário de adicionar
        document.getElementById('addForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            console.log('📝 Processando novo site...');
            
            let imageUrl = 'https://via.placeholder.com/300x200/2c5530/ffffff?text=Imagem+Não+Disponível';
            
            // Se foi selecionado um arquivo, fazer upload para o backend
            const fileInput = document.getElementById('itemImageFile');
            if (imageSourceType === 'file' && fileInput.files && fileInput.files[0]) {
                const arquivo = fileInput.files[0];
                console.log('🖼️ Arquivo selecionado:', arquivo.name);
                
                // Mostrar loading
                const submitBtn = document.getElementById('submitBtn');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando imagem...';
                submitBtn.disabled = true;
                
                try {
                    const url = await uploadImagem(arquivo);
                    
                    if (url) {
                        imageUrl = url;
                        console.log('✅ Usando imagem do upload:', imageUrl);
                    } else {
                        throw new Error('Upload falhou');
                    }
                } catch (error) {
                    console.error('❌ Erro no upload:', error);
                    showNotification('Erro ao fazer upload da imagem. Usando imagem padrão.', 'error');
                } finally {
                    // Restaurar botão
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            } else if (imageSourceType === 'url') {
                // Usar URL se for essa a opção
                imageUrl = document.getElementById('itemImageUrl').value || imageUrl;
                console.log('🔗 Usando URL da imagem:', imageUrl);
            }
            
            // Criar o novo site
            const newSite = {
                id: 'user-' + Date.now(),
                name: document.getElementById('itemName').value,
                type: document.getElementById('itemType').value,
                period: document.getElementById('itemPeriod').value,
                coords: [
                    parseFloat(document.getElementById('itemLat').value),
                    parseFloat(document.getElementById('itemLng').value)
                ],
                description: document.getElementById('itemDescription').value,
                image: imageUrl,
                siteUrl: document.getElementById('itemSiteUrl').value,
                status: 'Adicionado pelo Usuário',
                artifacts: Math.floor(Math.random() * 500) + 100,
                color: getColorByType(document.getElementById('itemType').value),
                justAdded: true
            };

            addSiteToMap(newSite);
            closeAddModal();
            this.reset();
            
            // Resetar visualização
            document.getElementById('fileName').textContent = 'Nenhum arquivo selecionado';
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('imagePreview').src = '';
            
            showNotification('Sítio adicionado com sucesso!', 'success');
        });

        function getColorByType(type) {
            const colors = {
                'Sítio em Escavação': '#ff0400',
                'Sítio Documentado': '#0022ff',
                'Área Protegida': '#00ff0d',
                'Artefato Registrado': '#ffb52c',
                'Estrutura Arqueológica': '#c800ff',
                'Museu Arqueológico': '#ffff00'
            };
            return colors[type] || '#6D4C41';
        }

        // Adicionar CSS para animações
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
            
            .delete-site-button:hover {
                background: transparent !important;
                color: #dc3545 !important;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>